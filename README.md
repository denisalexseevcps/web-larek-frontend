# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных
## Описание проекта

### Применяемый подход
В данном проекте используется событийно-ориентированный подход, который обеспечивает взаимодействие между компонентами приложения через формирование событий.                    

Кроме того, в проекте используется модель MVP (Model-View-Presenter), которая разделяет приложение на три основных компонента: модель, представлениe и презентатор. Модель отвечает за работу с данными, представление представляет собой интерфейс пользователя, а презентатор связывает модель и представление, обрабатывая события и передавая данные между ними. 

### Модель
Модель представлена двумя классами:
- класс MagazineApi - класс для работы с сетью, позволяет принимать и отправлять данные. Наследуется от базового класса API
Конструктор принимает и передает в родительский конструктор `Api` поля `baseUrl` и `options`, принимает и сохраняет входящий `url` запроса в `cdn`
Методы: - `getProductList` — метод получения списка товаров с сервера, - `orderProducts` — метод отправки данных заказа на сервер

- класс AppDate - класс для хранения данных в целом и основными методами их обработки. 
Поля: `catalog`: `IProduct`[] - для хранения данных полученных от сервера, `preview`: `IProduct` - для хранения данных предпосмотра карточки, `box`: `IBox` -
 для хранения данных о корзине, `boxObj`:` IProduct[]` - для полных данных о корзине, `order`: `IOrder` - для хранения данных о заказе, `FrameErrors`: `Partial<Record<keyof OrderFrame, string>>` - хранит ошибки валидации форм.
 Методы: `setItemToBox` - помешение товара в карзину, `inBox` - какие товары в корзине, `setCatalog` - помещает данные в каталог, `setPreview` - выдача данных для предпросмотра товара, `deliteToBox` - удаление товара из корзины, `clearBox` - очистка корзины, `validateOrder` - валидация введенных данных, `setPayMethod` - установка методов оплаты, `setOrderPole` - заполнение полей заказа

- класс Api - базовый класс для отправки и приема данных по сети. Получает и хранит базовый url (`baseUrl`) и опции запроса (`options`). 
Методы позволяют обработать запрос, отправить и получить данные. 

### Представление
- Component - базовый класс для работы с компонентами отображения. Конструктор: - принимает на вход `container` типа `HTMLElement`
Методы: `addClass` — метод переключения класса элемента, `setDisabled` — метод блокировки кнопки, `setText` — метод установки текста элемента, `setImage` — метод установки изображения элемента, `render` — метод слияния входящих данных и отрисовки элемента.

- Box - отвечает за представление карзины в модальном окне. Наследуется от класса `Component` по интерфейсу 
interface IBox {items: HTMLElement[]; total: number;}
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `EventEmitter` , передает `container` в родительский конструктор, сохраняет необходимые элементы разметки в полях, если есть `button`, вешает на нее слушатель `click` с регистрацией события `order:open` в качестве колбека
Методы: `set items` — устанавливает товары в разметку `_list`, `set total` — устанавливает значение суммы товаров

- Card - отвечает за представление карточки товара в главном окне. Наследуется от класса `Component` по интерфейсу 
interface ICard {
	title: string;
	category: string;
	image: string;
	price: number;
	text: string;
	viewButton: number;}
Конструктор принимает `container` типа `HTMLElement` и опциональный объект события `actions` типа `ICardActions`, передает `container` в родительский конструктор, сохраняет необходимые элементы разметки в полях, если объект `actions` был передан, то вешает слушатель клика на `container` с вызовом объекта события `actions`   
interface ICardActions {
    onClick: (event: MouseEvent) => void;}
Методы: `set title` — установка содержимого заголовка, `set category` — установка категории, `set image` — установка изображения, `set price` — установка цены

- CardPreview - отвечает за представление карточки в предпросмотре товара. Наследуется от класса `Card` по интерфейсу  `ICardPreview`
interface ICardPreview {
  text: string;}
Конструктор принимает `container` типа `HTMLElement` и опциональный объект события `actions` типа `ICardActions`, передает `container` и `actions` в родительский конструктор, сохраняет необходимые элементы разметки в полях, если объект `actions` был передан, то вешает слушатель клика на `_button` с вызовом объекта события `actions`, слушатель с `container` при этом удаляется
interface ICardActions {
    onClick: (event: MouseEvent) => void;}
Методы: `set text` — установка содержимого описания превью, `set viewButton` -выбор возможности заказа товара

- CardBox - отвечает за представление карточки в корзине. Наследуется от класса `Component` по интерфейсу  `ICardBasket`
interface ICardBasket {
  title: string;
  price: number;
  index: number;}
Конструктор принимает `container` типа `HTMLElement` и опциональный объект события `actions` типа `ICardActions`, передает `container` в родительский конструктор,  сохраняет необходимые элементы разметки в полях, если объект `actions` был передан, то вешает слушатель клика на `_button` с вызовом объекта события `actions`, слушатель с `container` при этом удаляется
interface ICardActions {
    onClick: (event: MouseEvent) => void;}
Методы: `set title` — установка заголовка, `set index` — установка содержимого порядкового номера, `set price` — установка цены

- Form - отвечает за основные методы работы с формой и ее валидации. Наследуется от класса `Component` по интерфейсу  `IFormState`
interface IFormState {
  valid: boolean;
  errors: string[];}
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`, передает `container` и `event` в родительский конструктор, сохраняет необходимые элементы разметки в полях, вешает на `container` слушатель `input` при котором определяется поле воздействия, его имя и значение, которые после отправляются методу класса `onInputChange` в качестве аргументов, вешает на `container` слушатель `submit` при котором происходит регистрация события с указанием имени `container`
Методы: `onInputChange` — регистрирует событие с именем конкретного поля, `set valid` — метод установки валидности, `set errors` — запись текста ошибки, `render` — отрисовка формы и ее элементов

- Modal - отвечает за основные свойства представления модальных окон. Наследуется от класса `Component` по интерфейсу  `IModalData`
interface IModalData {
	content: HTMLElement;}
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`, передает `container` в родительский конструктор, сохраняет необходимые элементы разметки в полях, вешает слушатель `click` на кнопку закрытия `_closeButton` и `container` с методом закрытия окна `close` в качестве колбека, вешает слушатель `click` на `content`
Методы: `set content` — установить контент окна, `open` — открыть модальное окно, `close` — закрыть модальное окно, `render` — отрисовать данные контента и открыть модальное окно.

- Order - отвечает за представление модального окна с типом оплаты и адресом доставки. Наследуется от класса `Form` по интерфейсу `IOrder`
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`, передает `container` и `event` в родительский конструктор, сохраняет необходимые элементы разметки в полях, на кнопки выбора формы оплаты вешает слушатель `click` по которому методом `payment` производится на кнопку.
Методы: `set payment` — устанавливает активную кнопку , `set address` — устанавливает адрес

- Сontacts - отвечает за представление модального окна с контактами пользователя. Наследуется от класса `Form` по интерфейсу `IOrder`
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`, передает `container` и `event` в родительский конструктор
Методы: `set phone` — запись телефона, `set email` — запись почты

- Page - отвечает за представление основных элементов страницы: каталог, корзина, счетчик товаров в корзине. Наследуется от класса `Component` по интерфейсу  `IPage`
interface IPage {
  catalog: HTMLElement[]}
Конструктор принимает `container` типа `HTMLElement` и объект `event` типа `IEvent`, передает `container` в родительский конструктор, сохраняет необходимые элементы разметки в полях, вешает на кнопку корзины `_basket` слушатель события `click`, при котором регистрируется событие `box:open`
Методы: `set counter` — устанавливает значение в счетчике товаров корзины, `set catalog` — устанавливает каталог, `set activeModal` — устанавливает класс, препятствующий прокрутке страницы

- Success - отвечает за отображение удачного заказа. Наследуется от класса `Component` по интерфейсу  `ISuccess`
interface ISuccess {
  total: number;}
Конструктор принимает `container` типа `HTMLElement` и опциональный объект события `actions` типа `ISuccessActions`,передает `container` в родительский конструктор, сохраняет необходимые элементы разметки в полях, если объект `actions` был передан, то вешает слушатель клика на `_close` с вызовом объекта события `actions`
interface ISuccessActions {
    onClick: () => void;}
Методы: `set total` — установка значения общей суммы.

### События
Основные события обрабатываемые в приложении 
- `catalog: change` - Данные с сервера о товарах получены и готовы к обработке
- `card:select` - Выбран товар и подготовка данных для предпросмотра
- `preview: change` - Готовы данные и открыт предпросмотр товара
- `modal:open` - открыто модальное окно
- `modal:close` - закрыто модальное окно
- `card: add` - товар добавлен в корзину
- `box:open` - открыта корзина с товарами
- `card:remove` - товар удален из корзины
- `order:open` - Перешли к оформлению заказа
- `formErrors:change` - Возникли ошибки валидации полей заказа
- `/^contacts\..*:change/` - изменены контактные данные пользователя
- `/^order\..*:change/` - изменен адрес доставки заказа
- `payment:change` - изменен тип оплаты
- `order:submit` - Добаление данных о способе оплаты и адресе доставки 
- `contacts:submit` - Добавление контактных данных пользователя. Отправка всех данных на сервер.

## Интерфейсы
Основные интерфейсы в приложении:
- тип PayMetod - тип видов оплаты
export type PayMetod = 'cash' | 'card';

- интерфейс IBox - для товаров в корзине
export interface IBox {
	items: string[];
	total: number;
}

- Интерфейс IProduct - описание карточки товара
export interface IProduct {
	id: string;
	title: string;
	price: number | null;
	description: string;
	image: string;
	category: string;
}

- интерфейс IOrder - описание заказа
export interface IOrder {
	payment: PayMetod;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
}

- тип OrderFrame - описание полей участвующих в валидации
export type OrderFrame = Omit<IOrder, 'total' | 'items'>;

- интерфейс IResultOrder - описание заказа для сервера
export interface IResultOrder {
	id: string;
	total: number;
}